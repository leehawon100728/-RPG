<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¼ë³¸ RPG - ë³´ìŠ¤ì™€ ì •ì˜ˆ</title>
    <style>
        body { background: #121212; color: #dcdcdc; font-family: 'Malgun Gothic', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        #auth-screen { width: 100%; max-width: 350px; background: #1c1c1c; padding: 30px; border-radius: 10px; border: 1px solid #3a3a3a; margin-top: 50px; }
        #game { display: none; width: 100%; max-width: 450px; background: #1c1c1c; padding: 25px; border-radius: 5px; border: 2px solid #3a3a3a; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        input { width: 100%; padding: 12px; margin-bottom: 10px; background: #000; border: 1px solid #444; color: #fff; box-sizing: border-box; }
        button { width: 100%; padding: 14px; border: 1px solid #555; background: #333; color: #eee; font-weight: bold; cursor: pointer; transition: 0.1s; }
        button:hover { background: #444; }
        .stats { display: flex; justify-content: space-between; font-size: 15px; background: #252525; padding: 12px; border: 1px solid #444; margin-bottom: 15px; }
        .weapon-box { text-align: center; padding: 20px; background: #000; border: 1px solid #444; margin-bottom: 15px; }
        .monster-area { background: #2d0000; padding: 15px; border: 1px solid #600; margin-bottom: 15px; text-align: center; position: relative; }
        .hp-bar { height: 12px; background: #333; border: 1px solid #555; margin-top: 10px; overflow: hidden; }
        #hp-fill { height: 100%; background: #c0392b; width: 100%; transition: 0.1s; }
        .inventory { background: #151515; border: 1px solid #444; padding: 10px; margin-top: 15px; display: none; max-height: 200px; overflow-y: auto; }
        .inv-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #333; font-size: 12px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .atk-btn { background: #4b4b4b; grid-column: span 2; font-size: 18px; }
        #log { height: 100px; background: #080808; border: 1px solid #333; padding: 10px; font-size: 12px; overflow-y: auto; margin-top: 15px; color: #999; }
        .rank-Legendary { color: #f1c40f; text-shadow: 0 0 5px gold; }
        .type-tag { font-size: 10px; padding: 2px 5px; border-radius: 3px; background: #444; margin-right: 5px; color: #fff; }
        
        /* ëª¬ìŠ¤í„° íƒœê·¸ */
        .m-tag { font-size: 12px; font-weight: bold; padding: 2px 8px; border-radius: 10px; display: inline-block; margin-bottom: 5px; }
        .tag-normal { background: #555; }
        .tag-elite { background: #d35400; color: #fff; box-shadow: 0 0 8px #d35400; }
        .tag-boss { background: #c0392b; color: #fff; box-shadow: 0 0 12px #c0392b; font-size: 14px; }

        #prob-table { font-size: 11px; background: #222; padding: 10px; border: 1px solid #444; margin-top: 10px; display: none; width: 100%; box-sizing: border-box; }
        .prob-row { display: flex; justify-content: space-between; border-bottom: 1px solid #333; padding: 4px 0; }
    </style>
</head>
<body>

<div id="auth-screen">
    <h2 style="text-align: center;">RPG ì ‘ì†</h2>
    <input type="text" id="user-id" placeholder="ì•„ì´ë””">
    <input type="password" id="user-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button onclick="handleAuth()">ëª¨í—˜ ì‹œì‘</button>
</div>

<div id="game">
    <div class="stats">
        <span>ğŸ’° <b id="gold" style="color: #f1c40f;">0</b></span>
        <span>âš”ï¸ <b id="atk" style="color: #ff4757;">0</b></span>
    </div>

    <div class="weapon-box">
        <div id="w-rank">RANK</div>
        <div><span id="w-type" class="type-tag">TYPE</span><b id="w-name" style="font-size:20px;">ë¬´ê¸°</b></div>
        <div id="w-enchant" style="color: #4cd137; font-size: 22px;">+0</div>
    </div>

    <div class="monster-area">
        <div id="m-badge" class="m-tag tag-normal">ì¼ë°˜</div>
        <div id="m-name" style="font-size:18px; font-weight:bold;">ëª¬ìŠ¤í„°</div>
        <div id="m-weak" style="font-size:11px; color:#ff7675; margin-top:5px;">ìƒì„± ë¡œë”©ì¤‘...</div>
        <div class="hp-bar"><div id="hp-fill"></div></div>
    </div>

    <div class="btn-grid">
        <button class="atk-btn" onclick="attack()">âš”ï¸ ì‚¬ëƒ¥í•˜ê¸°</button>
        <button onclick="enchant()">ğŸ”¥ ê°•í™”</button>
        <button onclick="gacha()">âœ¨ ë°œêµ´</button>
        <button onclick="toggleInv()">ğŸ’ ê°€ë°©</button>
        <button onclick="toggleProb()">ğŸ“Š í™•ë¥  ë° ì •ë³´</button>
    </div>

    <div id="prob-table">
        <div style="font-weight:bold; color:#f1c40f; margin-bottom:5px;">[ê°•í™” ë° ì‹œìŠ¤í…œ í™•ë¥ ]</div>
        <div class="prob-row"><span>+1 ~ +10ê°•</span> <span>90% ~ 30%</span></div>
        <div class="prob-row"><span>+11 ~ +20ê°•</span> <span>25% ~ 2% (ìµœëŒ€ 20)</span></div>
        <div class="prob-row" style="color:#d35400;"><span>ì •ì˜ˆ ëª¬ìŠ¤í„° ë“±ì¥</span> <span>2% (ì²´ë ¥ 1.5ë°° / ë³´ìƒ 2ë°°)</span></div>
        <div class="prob-row" style="color:#c0392b;"><span>ë³´ìŠ¤ ëª¬ìŠ¤í„° ë“±ì¥</span> <span>ë§¤ 5ë ˆë²¨ (ì²´ë ¥ 3ë°° / ë³´ìƒ 5ë°°)</span></div>
        <div class="prob-row"><span>ìƒì„± ë°°ìœ¨</span> <span>ìœ ë¦¬ 2.0x / ë¶ˆë¦¬ 0.5x</span></div>
    </div>

    <div id="inventory" class="inventory"><div id="inv-list"></div></div>
    <div id="log">> ìƒˆë¡œìš´ ëŒ€ë¥™ì— ë°œì„ ë“¤ì˜€ìŠµë‹ˆë‹¤.</div>
</div>

<script>
    let currentUser = null;
    let state = null;
    let curHp = 0;
    let maxHp = 0;
    let isElite = false;
    let isBoss = false;

    const synergy = {
        "ì¹¼": { "ê²©íˆ¬": 2.0, "í™œ": 0.5 },
        "í™œ": { "ì§€íŒ¡ì´": 2.0, "ê²©íˆ¬": 0.5 },
        "ì§€íŒ¡ì´": { "ì¹¼": 2.0, "ê²©íˆ¬": 0.5 },
        "ê²©íˆ¬": { "í™œ": 2.0, "ì§€íŒ¡ì´": 0.5 }
    };

    const normalMonsters = ["ìŠ¬ë¼ì„", "ê³ ë¸”ë¦°", "ë°•ì¥", "ì¢€ë¹„", "ìŠ¤ì¼ˆë ˆí†¤", "ê±°ë¯¸", "ì˜¤í¬", "ë„ì ", "í•˜í”¼"];
    const bossMonsters = ["ë°œë¡", "ë¦¬ì¹˜ í‚¹", "ë² í—¤ëª¨ìŠ¤", "ê³ ëŒ€ ë“œë˜ê³¤", "ì‹¬ì—°ì˜ ì£¼ì¸"];

    function handleAuth() {
        const id = document.getElementById('user-id').value;
        const pw = document.getElementById('user-pw').value;
        if(!id || !pw) return;
        let stored = JSON.parse(localStorage.getItem(`user_rpg_v3_${id}`));
        if(!stored) {
            stored = { pw: pw, gameData: null };
            localStorage.setItem(`user_rpg_v3_${id}`, JSON.stringify(stored));
        } else if(stored.pw !== pw) return alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜.");
        
        currentUser = id;
        state = stored.gameData || {
            gold: 0, monsterLvl: 1,
            inventory: [{ id: Date.now(), name: "ë‚˜ë¬´ ì¹¼", rank: "Common", type: "ì¹¼", enchant: 0, power: 10 }],
            equippedId: null
        };
        if(!state.equippedId) state.equippedId = state.inventory[0].id;
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('game').style.display = 'block';
        resetMonster();
        updateUI();
    }

    function resetMonster() {
        isBoss = state.monsterLvl % 5 === 0; // 5ë ˆë²¨ë§ˆë‹¤ ë³´ìŠ¤
        isElite = !isBoss && Math.random() < 0.02; // ë³´ìŠ¤ê°€ ì•„ë‹ ë•Œ 2% í™•ë¥ ë¡œ ì •ì˜ˆ

        let baseHp = 50 + (state.monsterLvl * 35);
        let badge = document.getElementById('m-badge');
        
        if (isBoss) {
            maxHp = baseHp * 3;
            badge.innerText = "BOSS";
            badge.className = "m-tag tag-boss";
            document.getElementById('m-name').innerText = bossMonsters[Math.min(Math.floor(state.monsterLvl/5)-1, bossMonsters.length-1)];
        } else if (isElite) {
            maxHp = baseHp * 1.5;
            badge.innerText = "ELITE";
            badge.className = "m-tag tag-elite";
            document.getElementById('m-name').innerText = "ì •ì˜ˆ " + normalMonsters[Math.floor(Math.random() * normalMonsters.length)];
        } else {
            maxHp = baseHp;
            badge.innerText = "NORMAL";
            badge.className = "m-tag tag-normal";
            document.getElementById('m-name').innerText = normalMonsters[Math.floor(Math.random() * normalMonsters.length)];
        }

        curHp = maxHp;
        state.mType = ["ì¹¼", "í™œ", "ì§€íŒ¡ì´", "ê²©íˆ¬"][Math.floor(Math.random() * 4)];
    }

    function attack() {
        const weapon = state.inventory.find(i => i.id === state.equippedId);
        let ratio = synergy[weapon.type][state.mType] || 1.0;
        let damage = (10 + weapon.power + (weapon.enchant * (weapon.power * 0.4))) * ratio;
        
        curHp -= damage;
        if(curHp <= 0) {
            let reward = (20 + state.monsterLvl * 10);
            if (isBoss) {
                reward *= 5;
                log(`ğŸ‘‘ ë³´ìŠ¤ ì²˜ì¹˜! ë³´ìƒ 5ë°°: ${reward}G`);
            } else if (isElite) {
                reward *= 2;
                log(`ğŸ”¶ ì •ì˜ˆ ì²˜ì¹˜! ë³´ìƒ 2ë°°: ${reward}G`);
            } else {
                log(`ì „íˆ¬ ìŠ¹ë¦¬: ${reward}G`);
            }
            state.gold += reward;
            state.monsterLvl++;
            resetMonster();
        }
        updateUI();
    }

    function updateUI() {
        const weapon = state.inventory.find(i => i.id === state.equippedId);
        document.getElementById('gold').innerText = state.gold.toLocaleString();
        let ratio = synergy[weapon.type][state.mType] || 1.0;
        let totalAtk = (10 + weapon.power + (weapon.enchant * (weapon.power * 0.4))) * ratio;
        
        document.getElementById('atk').innerText = Math.floor(totalAtk).toLocaleString();
        document.getElementById('w-name').innerText = weapon.name;
        document.getElementById('w-type').innerText = weapon.type;
        document.getElementById('w-enchant').innerText = "+" + weapon.enchant;
        document.getElementById('m-weak').innerHTML = `ëª¬ìŠ¤í„° ì†ì„±: <b>[${state.mType}]</b> (ë°ë¯¸ì§€ ${ratio}x ì ìš© ì¤‘)`;
        document.getElementById('hp-fill').style.width = (curHp / maxHp * 100) + "%";
        
        renderInv();
        save();
    }

    function enchant() {
        let weapon = state.inventory.find(i => i.id === state.equippedId);
        if(weapon.enchant >= 20) return log("ì´ë¯¸ ìµœëŒ€ ê°•í™”ì…ë‹ˆë‹¤.");
        let cost = 100 + (weapon.enchant * 100);
        if(state.gold < cost) return log("ê³¨ë“œ ë¶€ì¡±.");
        
        state.gold -= cost;
        let chance = (weapon.enchant < 10) ? (100 - weapon.enchant * 7) : Math.max(2, 30 - (weapon.enchant - 10) * 3);
        
        if(Math.random() * 100 < chance) {
            weapon.enchant++;
            log(`ê°•í™” ì„±ê³µ! (+${weapon.enchant})`);
        } else {
            log("ê°•í™” ì‹¤íŒ¨.");
        }
        updateUI();
    }

    function gacha() {
        if(state.gold < 500) return log("ê³¨ë“œ ë¶€ì¡±.");
        state.gold -= 500;
        const types = ["ì¹¼", "í™œ", "ì§€íŒ¡ì´", "ê²©íˆ¬"];
        const type = types[Math.floor(Math.random() * 4)];
        const isLegend = Math.random() < 0.03;
        state.inventory.push({ 
            id: Date.now(), 
            name: isLegend ? "íƒœê³ ì˜ " + type : "ì² ì œ " + type, 
            rank: isLegend ? "Legendary" : "Common", 
            type: type, 
            enchant: 0, 
            power: isLegend ? 250 : 35 
        });
        log(`ë¬´ê¸° ë°œêµ´ ì™„ë£Œ!`);
        updateUI();
    }

    function save() {
        const stored = JSON.parse(localStorage.getItem(`user_rpg_v3_${currentUser}`));
        stored.gameData = state;
        localStorage.setItem(`user_rpg_v3_${currentUser}`, JSON.stringify(stored));
    }

    function toggleInv() { const i = document.getElementById('inventory'); i.style.display = i.style.display === 'block' ? 'none' : 'block'; }
    function toggleProb() { const p = document.getElementById('prob-table'); p.style.display = p.style.display === 'block' ? 'none' : 'block'; }
    function log(m) { const l = document.getElementById('log'); l.innerHTML = `<div>> ${m}</div>` + l.innerHTML; }
    function renderInv() {
        document.getElementById('inv-list').innerHTML = state.inventory.map(item => `
            <div class="inv-item">
                <span class="rank-${item.rank}">[${item.type}] ${item.name} (+${item.enchant})</span>
                <button onclick="state.equippedId=${item.id}; updateUI();" style="width:50px; padding:3px;">ì¥ì°©</button>
            </div>`).join('');
    }
</script>
</body>
</html>
