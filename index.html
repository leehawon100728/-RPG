<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í´ë¦­ RPG - ë¦¬ë§ˆìŠ¤í„°</title>
    <style>
        body { background: #121212; color: #dcdcdc; font-family: 'Malgun Gothic', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .auth-container { width: 100%; max-width: 350px; background: #1c1c1c; padding: 30px; border-radius: 10px; border: 1px solid #3a3a3a; margin-top: 50px; }
        #game { display: none; width: 100%; max-width: 450px; background: #1c1c1c; padding: 25px; border-radius: 5px; border: 2px solid #3a3a3a; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        input { width: 100%; padding: 12px; margin-bottom: 10px; background: #000; border: 1px solid #444; color: #fff; box-sizing: border-box; }
        button { width: 100%; padding: 14px; border: 1px solid #555; background: #333; color: #eee; font-weight: bold; cursor: pointer; transition: 0.1s; border-radius: 4px; }
        button:hover { background: #444; }
        .stats { display: flex; justify-content: space-between; font-size: 15px; background: #252525; padding: 12px; border: 1px solid #444; margin-bottom: 15px; }
        .weapon-box { text-align: center; padding: 20px; background: #000; border: 1px solid #444; margin-bottom: 15px; }
        .monster-area { background: #2d0000; padding: 15px; border: 1px solid #600; margin-bottom: 15px; text-align: center; }
        .hp-bar { height: 12px; background: #333; border: 1px solid #555; margin-top: 10px; overflow: hidden; }
        #hp-fill { height: 100%; background: #c0392b; width: 100%; transition: 0.1s; }
        .inventory { background: #151515; border: 1px solid #444; padding: 10px; margin-top: 15px; display: none; max-height: 200px; overflow-y: auto; }
        .inv-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #333; font-size: 12px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .atk-btn { background: #4b4b4b; grid-column: span 2; font-size: 18px; }
        #log { height: 100px; background: #080808; border: 1px solid #333; padding: 10px; font-size: 12px; overflow-y: auto; margin-top: 15px; color: #999; }
        .synergy-guide { background: #1a1a1a; padding: 10px; border: 1px solid #444; margin-bottom: 15px; font-size: 11px; line-height: 1.5; }
        .up { color: #55efc4; } .down { color: #ff7675; }
        .m-tag { font-size: 12px; font-weight: bold; padding: 2px 8px; border-radius: 10px; display: inline-block; margin-bottom: 5px; }
        .tag-normal { background: #555; } .tag-elite { background: #d35400; } .tag-boss { background: #c0392b; }
        .admin-box { margin-top: 15px; display: flex; gap: 5px; border-top: 1px solid #333; padding-top: 15px; }
    </style>
</head>
<body>

<div id="login-screen" class="auth-container">
    <h2 style="text-align: center;">í´ë¦­ RPG ë¡œê·¸ì¸</h2>
    <input type="text" id="login-id" placeholder="ì•„ì´ë””">
    <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button onclick="handleLogin()">ë¡œê·¸ì¸</button>
    <p onclick="showScreen('signup-screen')" style="text-align:center; font-size:12px; color:#888; cursor:pointer; margin-top:15px;">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…</p>
</div>

<div id="signup-screen" class="auth-container" style="display:none;">
    <h2 style="text-align: center;">ìš©ì‚¬ ë“±ë¡</h2>
    <input type="text" id="signup-id" placeholder="ì•„ì´ë””">
    <input type="password" id="signup-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <input type="password" id="signup-pw-confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
    <button onclick="handleSignup()">ê°€ì… ì™„ë£Œ</button>
    <p onclick="showScreen('login-screen')" style="text-align:center; font-size:12px; color:#888; cursor:pointer; margin-top:15px;">ëŒì•„ê°€ê¸°</p>
</div>

<div id="game">
    <div style="text-align:center; margin-bottom:10px;"><h2 style="margin:0; color:#f1c40f;">í´ë¦­ RPG</h2></div>
    <div class="stats">
        <span>ğŸ’° <b id="gold">0</b></span>
        <span>âš”ï¸ <b id="atk">0</b></span>
    </div>

    <div class="synergy-guide">
        <div style="font-weight:bold; color:#f1c40f; text-align:center; margin-bottom:3px;">[ ìƒì„± ì •ë³´ ë° í™•ë¥  ]</div>
        â€¢ ğŸ—¡ï¸ì¹¼>ê²©íˆ¬ / ğŸ¹í™œ>ì§€íŒ¡ì´ / ğŸª„ì§€íŒ¡ì´>ì¹¼ / ğŸ¥Šê²©íˆ¬>í™œ <b class="up">(2x)</b><br>
        â€¢ ë³´ìŠ¤ ì²˜ì¹˜ ì „ê¹Œì§€ ëª¬ìŠ¤í„° ì†ì„± <b>ê³ ì •</b><br>
        â€¢ ë¬´ê¸°ë½‘ê¸°: ì „ì„¤ 3% / ê³ ê¸‰ë½‘ê¸°: <b>ì „ì„¤ 15%</b><br>
        â€¢ ì •ì˜ˆ ë“±ì¥: 2% (ë³´ìƒ 2ë°°) / ë³´ìŠ¤: 5ë ˆë²¨ë§ˆë‹¤ (ë³´ìƒ 5ë°°)
    </div>

    <div class="weapon-box">
        <div id="w-rank" style="font-size:12px; color:#aaa;">RANK</div>
        <div><span id="w-type" class="type-tag" style="background:#444; font-size:10px; padding:2px 5px; border-radius:3px; margin-right:5px;">TYPE</span><b id="w-name" style="font-size:20px;">ë¬´ê¸°</b></div>
        <div id="w-enchant" style="color: #4cd137; font-size: 22px;">+0</div>
    </div>

    <div class="monster-area">
        <div id="m-badge" class="m-tag tag-normal">NORMAL</div>
        <div id="m-name" style="font-size:18px; font-weight:bold;">ëª¬ìŠ¤í„°</div>
        <div id="m-weak" style="font-size:11px; color:#ff7675; margin-top:5px;">ì†ì„± ë¶„ì„ ì¤‘...</div>
        <div class="hp-bar"><div id="hp-fill"></div></div>
    </div>

    <div class="btn-grid">
        <button class="atk-btn" onclick="attack()">âš”ï¸ ì‚¬ëƒ¥í•˜ê¸°</button>
        <button onclick="enchant()" id="btn-enchant">ğŸ”¥ ê°•í™” (100G)</button>
        <button onclick="gacha('normal')" id="btn-gacha">âœ¨ ë¬´ê¸°ë½‘ê¸° (500G)</button>
        <button onclick="gacha('high')" id="btn-gacha-high" style="background:#4a3300;">ğŸ’ ê³ ê¸‰ë½‘ê¸° (3,000G)</button>
        <button onclick="toggleInv()">ğŸ’ ê°€ë°©</button>
        <button onclick="logout()" style="background:#222;">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div id="inventory" class="inventory"><div id="inv-list"></div></div>
    <div id="log">> ë§ˆì„ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤.</div>

    <div class="admin-box">
        <input type="text" id="cheat-code" style="flex:1; padding:8px; margin:0; font-size:12px;" placeholder="ì½”ë“œ...">
        <button onclick="applyCheat()" style="width:60px; padding:8px; font-size:12px;">ì ìš©</button>
    </div>
</div>

<script>
    let currentUser = null;
    let state = null;
    let curHp = 0, maxHp = 0, isElite = false, isBoss = false;

    const synergy = { "ì¹¼": { "ê²©íˆ¬": 2.0, "í™œ": 0.5 }, "í™œ": { "ì§€íŒ¡ì´": 2.0, "ê²©íˆ¬": 0.5 }, "ì§€íŒ¡ì´": { "ì¹¼": 2.0, "ê²©íˆ¬": 0.5 }, "ê²©íˆ¬": { "í™œ": 2.0, "ì§€íŒ¡ì´": 0.5 } };

    function showScreen(id) {
        ['login-screen', 'signup-screen', 'game'].forEach(s => document.getElementById(s).style.display = 'none');
        document.getElementById(id).style.display = 'block';
    }

    function handleSignup() {
        const id = document.getElementById('signup-id').value.trim(), pw = document.getElementById('signup-pw').value, pwc = document.getElementById('signup-pw-confirm').value;
        if(!id || !pw) return alert("ì…ë ¥ ì˜¤ë¥˜"); if(pw !== pwc) return alert("ë¹„ë²ˆ ë¶ˆì¼ì¹˜");
        if(localStorage.getItem(`click_rpg_v7_${id}`)) return alert("ì¤‘ë³µ ì•„ì´ë””");
        localStorage.setItem(`click_rpg_v7_${id}`, JSON.stringify({ pw: pw, gameData: null }));
        alert("ê°€ì… ì„±ê³µ!"); showScreen('login-screen');
    }

    function handleLogin() {
        const id = document.getElementById('login-id').value.trim(), pw = document.getElementById('login-pw').value;
        const stored = JSON.parse(localStorage.getItem(`click_rpg_v7_${id}`));
        if(!stored) return alert("ì—†ëŠ” ê³„ì •"); if(stored.pw !== pw) return alert("ë¹„ë²ˆ í‹€ë¦¼");
        currentUser = id;
        state = stored.gameData || { gold: 0, monsterLvl: 1, inventory: [{ id: Date.now(), name: "ì´ˆë³´ ê²€", rank: "Common", type: "ì¹¼", enchant: 0, power: 15 }], equippedId: null, mType: "ê²©íˆ¬" };
        if(!state.equippedId) state.equippedId = state.inventory[0].id;
        showScreen('game'); resetMonster(true); updateUI();
    }

    function resetMonster(isNewType) {
        isBoss = state.monsterLvl % 5 === 0;
        isElite = !isBoss && Math.random() < 0.02;
        let baseHp = 50 + (state.monsterLvl * 50);
        if (isBoss) { maxHp = baseHp * 3; document.getElementById('m-badge').className="m-tag tag-boss"; document.getElementById('m-badge').innerText="BOSS"; }
        else if (isElite) { maxHp = baseHp * 1.5; document.getElementById('m-badge').className="m-tag tag-elite"; document.getElementById('m-badge').innerText="ELITE"; }
        else { maxHp = baseHp; document.getElementById('m-badge').className="m-tag tag-normal"; document.getElementById('m-badge').innerText="NORMAL"; }
        curHp = maxHp;
        // ë³´ìŠ¤ì „ ì§í›„ë‚˜ ì²« ì ‘ì† ì‹œì—ë§Œ ì†ì„± ë³€ê²½
        if(isNewType) state.mType = ["ì¹¼", "í™œ", "ì§€íŒ¡ì´", "ê²©íˆ¬"][Math.floor(Math.random() * 4)];
        document.getElementById('m-name').innerText = `Lv.${state.monsterLvl} ëª¬ìŠ¤í„°`;
    }

    function attack() {
        const weapon = state.inventory.find(i => i.id === state.equippedId);
        let ratio = (synergy[weapon.type] && synergy[weapon.type][state.mType]) || 1.0;
        let damage = (15 + weapon.power + (weapon.enchant * (weapon.power * 0.4))) * ratio;
        curHp -= damage;
        if(curHp <= 0) {
            let reward = (25 + state.monsterLvl * 15) * (isBoss ? 5 : (isElite ? 2 : 1));
            state.gold += Math.floor(reward);
            state.monsterLvl++;
            resetMonster(isBoss); // ë³´ìŠ¤ë¥¼ ì¡ì•˜ì„ ë•Œë§Œ ì†ì„± ë³€ê²½
            log(`ìŠ¹ë¦¬! +${reward}G íšë“`);
        }
        updateUI();
    }

    function updateUI() {
        const weapon = state.inventory.find(i => i.id === state.equippedId);
        document.getElementById('gold').innerText = state.gold.toLocaleString();
        let ratio = (synergy[weapon.type] && synergy[weapon.type][state.mType]) || 1.0;
        let totalAtk = (15 + weapon.power + (weapon.enchant * (weapon.power * 0.4))) * ratio;
        document.getElementById('atk').innerText = Math.floor(totalAtk).toLocaleString();
        document.getElementById('w-name').innerText = weapon.name;
        document.getElementById('w-name').style.color = weapon.rank === "Legendary" ? "#f1c40f" : "#fff";
        document.getElementById('w-type').innerText = weapon.type;
        document.getElementById('w-rank').innerText = weapon.rank;
        document.getElementById('w-enchant').innerText = "+" + weapon.enchant;
        document.getElementById('btn-enchant').innerText = `ğŸ”¥ ê°•í™” (${100 + (weapon.enchant * 200)}G)`;
        document.getElementById('m-weak').innerHTML = `í˜„ì¬ ì†ì„±: <b>[${state.mType}]</b> (${ratio}x ë°ë¯¸ì§€)`;
        document.getElementById('hp-fill').style.width = Math.max(0, (curHp / maxHp * 100)) + "%";
        renderInv(); save();
    }

    function gacha(type) {
        let cost = type === 'high' ? 3000 : 500;
        if(state.gold < cost) return log("ê³¨ë“œ ë¶€ì¡±!");
        state.gold -= cost;
        const types = ["ì¹¼", "í™œ", "ì§€íŒ¡ì´", "ê²©íˆ¬"];
        const t = types[Math.floor(Math.random() * 4)];
        const isLegend = Math.random() < (type === 'high' ? 0.15 : 0.03);
        state.inventory.push({ id: Date.now(), name: (isLegend ? "ì „ì„¤ì˜ " : "ì² ì œ ") + t, rank: isLegend ? "Legendary" : "Common", type: t, enchant: 0, power: isLegend ? 300 : 40 });
        log(`${type === 'high' ? 'ê³ ê¸‰' : 'ì¼ë°˜'} ë½‘ê¸° ì„±ê³µ!`);
        updateUI();
    }

    function enchant() {
        let weapon = state.inventory.find(i => i.id === state.equippedId);
        if(weapon.enchant >= 20) return log("ìµœëŒ€ ê°•í™”!");
        let cost = 100 + (weapon.enchant * 200);
        if(state.gold < cost) return log("ê³¨ë“œ ë¶€ì¡±!");
        state.gold -= cost;
        let chance = (weapon.enchant < 10) ? (90 - weapon.enchant * 8) : Math.max(2, 25 - (weapon.enchant - 10) * 3);
        if(Math.random() * 100 < chance) { weapon.enchant++; log("ê°•í™” ì„±ê³µ!"); } else log("ê°•í™” ì‹¤íŒ¨.");
        updateUI();
    }

    function applyCheat() {
        if(document.getElementById('cheat-code').value === "191016") { state.gold += 1000000; log("ì¹˜íŠ¸ ì ìš©!"); updateUI(); }
    }

    function save() {
        const key = `click_rpg_v7_${currentUser}`;
        const data = JSON.parse(localStorage.getItem(key));
        data.gameData = state;
        localStorage.setItem(key, JSON.stringify(data));
    }

    function logout() { location.reload(); }
    function toggleInv() { const i = document.getElementById('inventory'); i.style.display = i.style.display === 'block' ? 'none' : 'block'; }
    function log(m) { const l = document.getElementById('log'); l.innerHTML = `<div>> ${m}</div>` + l.innerHTML; }
    function renderInv() {
        document.getElementById('inv-list').innerHTML = state.inventory.map(item => `
            <div class="inv-item">
                <span style="color:${item.rank === 'Legendary' ? '#f1c40f' : '#ccc'}">[${item.type}] ${item.name} (+${item.enchant})</span>
                <button onclick="state.equippedId=${item.id}; updateUI();" style="width:50px; padding:3px; font-size:10px;">ì¥ì°©</button>
            </div>`).join('');
    }
</script>
</body>
</html>
