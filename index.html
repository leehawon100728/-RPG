<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¼ë³¸ RPG - ë¦¬ë§ˆìŠ¤í„°</title>
    <style>
        body { background: #121212; color: #dcdcdc; font-family: 'Malgun Gothic', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        #game { width: 100%; max-width: 400px; background: #1c1c1c; padding: 25px; border-radius: 5px; border: 2px solid #3a3a3a; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        .header { text-align: center; border-bottom: 2px solid #3a3a3a; padding-bottom: 15px; margin-bottom: 20px; }
        .stats { display: flex; justify-content: space-between; font-size: 15px; background: #252525; padding: 12px; border: 1px solid #444; margin-bottom: 20px; }
        .weapon-box { text-align: center; padding: 25px; background: #000; border: 1px solid #444; margin-bottom: 20px; }
        .weapon-name { font-size: 22px; font-weight: bold; }
        .monster-area { background: #2d0000; padding: 15px; border: 1px solid #600; margin-bottom: 20px; text-align: center; }
        .hp-bar { height: 12px; background: #333; border: 1px solid #555; margin-top: 10px; overflow: hidden; }
        #hp-fill { height: 100%; background: #c0392b; width: 100%; transition: 0.1s; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { padding: 14px; border: 1px solid #555; background: #333; color: #eee; font-weight: bold; cursor: pointer; }
        button:hover { background: #444; }
        .atk-btn { background: #4b4b4b; grid-column: span 2; margin-bottom: 5px; }
        
        /* ìƒì„¸ í™•ë¥ í‘œ íŒì—…/íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .info-panel { width: 100%; max-width: 400px; margin-top: 20px; background: #1c1c1c; padding: 15px; border: 1px solid #3a3a3a; display: none; }
        .info-title { font-weight: bold; color: #f1c40f; margin-bottom: 10px; border-bottom: 1px solid #3a3a3a; padding-bottom: 5px; display: flex; justify-content: space-between; }
        .prob-table { width: 100%; border-collapse: collapse; font-size: 12px; text-align: center; }
        .prob-table th, .prob-table td { border: 1px solid #3a3a3a; padding: 5px; }
        .prob-table th { background: #252525; }

        .admin-box { margin-top: 15px; display: flex; gap: 5px; }
        .admin-input { flex: 1; background: #000; border: 1px solid #444; color: #0f0; padding: 5px; font-family: monospace; }
        
        #log { height: 100px; background: #080808; border: 1px solid #333; padding: 10px; font-size: 12px; overflow-y: auto; margin-top: 15px; color: #999; }
        .rank-common { color: #aaa; } .rank-rare { color: #3498db; } .rank-epic { color: #9b59b6; } .rank-legend { color: #f1c40f; }
    </style>
</head>
<body>

<div id="game">
    <div class="header"><h1>ê·¼ë³¸ RPG</h1></div>
    <div class="stats">
        <span>ê³¨ë“œ: <b id="gold" style="color: #f1c40f;">0</b>G</span>
        <span>ê³µê²©ë ¥: <b id="atk" style="color: #ff4757;">15</b></span>
    </div>
    <div class="weapon-box">
        <div id="w-rank" class="rank-common">COMMON</div>
        <div id="w-name" class="weapon-name">ìˆ˜ë ¨ìš© ëª©ê²€</div>
        <div id="w-enchant" style="color: #4cd137;">+0</div>
    </div>
    <div class="monster-area">
        <div id="m-name">ë“¤ì¥ (Lv.1)</div>
        <div class="hp-bar"><div id="hp-fill"></div></div>
    </div>
    <div class="btn-grid">
        <button class="atk-btn" onclick="attack()">ì‹¬ì—°ì˜ ìˆ˜ë ¨ (ê³µê²©)</button>
        <button onclick="enchant()">ê°•í™” (100G)</button>
        <button onclick="gacha()">ë°œêµ´ (500G)</button>
        <button onclick="toggleInfo()" style="grid-column: span 2; background: #252525; margin-top: 5px; font-size: 12px;">ğŸ” ìƒì„¸ í™•ë¥  ì •ë³´ ë³´ê¸°</button>
    </div>
    <div id="log">> ëŒ€ë¥™ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.</div>
    
    <div class="admin-box">
        <input type="text" id="adminCode" class="admin-input" placeholder="ìš´ì˜ì ì½”ë“œ ì…ë ¥...">
        <button onclick="checkAdminCode()" style="padding: 5px 10px; font-size: 12px;">ì ìš©</button>
    </div>
</div>

<div id="infoPanel" class="info-panel">
    <div class="info-title"><span>ğŸ“Š ê°•í™” ìƒì„¸ í™•ë¥ í‘œ</span> <span style="cursor:pointer" onclick="toggleInfo()">[ë‹«ê¸°]</span></div>
    <table class="prob-table">
        <thead>
            <tr><th>ê°•í™” ë‹¨ê³„</th><th>ì„±ê³µ í™•ë¥ </th><th>ì‹¤íŒ¨ ì‹œ íŒ¨ë„í‹°</th></tr>
        </thead>
        <tbody id="probBody">
            </tbody>
    </table>
    <div class="info-title" style="margin-top:15px;"><span>âœ¨ ìœ ë¬¼ ë°œêµ´ í™•ë¥ </span></div>
    <table class="prob-table">
        <tr><td>Legendary</td><td>1%</td></tr>
        <tr><td>Epic</td><td>6%</td></tr>
        <tr><td>Rare</td><td>18%</td></tr>
        <tr><td>Common</td><td>75%</td></tr>
    </table>
</div>

<script>
    let state = JSON.parse(localStorage.getItem('rpg_save')) || {
        gold: 0,
        baseAtk: 15,
        weapon: { name: "ìˆ˜ë ¨ìš© ëª©ê²€", rank: "Common", enchant: 0, power: 5 },
        monsterLvl: 1
    };

    const ranks = {
        Common: { color: "rank-common", power: 5 },
        Rare: { color: "rank-rare", power: 30 },
        Epic: { color: "rank-epic", power: 100 },
        Legendary: { color: "rank-legend", power: 400 }
    };

    // ì •í™•í•œ ë‹¨ê³„ë³„ í™•ë¥  ì •ì˜ (0ê°•~15ê°• ì´ìƒ)
    const enchantProbs = [
        { step: "0 â†’ 1", chance: 100, penalty: "ì—†ìŒ" },
        { step: "1 â†’ 2", chance: 90, penalty: "ì—†ìŒ" },
        { step: "2 â†’ 3", chance: 80, penalty: "ì—†ìŒ" },
        { step: "3 â†’ 4", chance: 70, penalty: "ë‹¨ê³„ í•˜ë½ (-1)" },
        { step: "4 â†’ 5", chance: 60, penalty: "ë‹¨ê³„ í•˜ë½ (-1)" },
        { step: "5 â†’ 6", chance: 50, penalty: "ë‹¨ê³„ í•˜ë½ (-1)" },
        { step: "6 â†’ 7", chance: 40, penalty: "ë‹¨ê³„ í•˜ë½ (-1)" },
        { step: "7 â†’ 8", chance: 30, penalty: "ë‹¨ê³„ í•˜ë½ (-1)" },
        { step: "8 â†’ 9", chance: 20, penalty: "ë‹¨ê³„ í•˜ë½ (-1)" },
        { step: "9 â†’ 10", chance: 15, penalty: "ë‹¨ê³„ í•˜ë½ (-2)" },
        { step: "10 â†’ 11", chance: 10, penalty: "ë‹¨ê³„ í•˜ë½ (-2)" },
        { step: "11 â†’ 12", chance: 7, penalty: "ë‹¨ê³„ í•˜ë½ (-3)" },
        { step: "12 â†’ 13", chance: 5, penalty: "ë‹¨ê³„ í•˜ë½ (-3)" },
        { step: "13 â†’ 14", chance: 3, penalty: "ë‹¨ê³„ í•˜ë½ (-4)" },
        { step: "14 â†’ 15", chance: 1, penalty: "ë‹¨ê³„ í•˜ë½ (-5)" }
    ];

    let curHp = 50 + (state.monsterLvl * 40);

    function saveGame() { localStorage.setItem('rpg_save', JSON.stringify(state)); }

    function toggleInfo() {
        const panel = document.getElementById('infoPanel');
        panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        if(panel.style.display === 'block') renderProbTable();
    }

    function renderProbTable() {
        const body = document.getElementById('probBody');
        body.innerHTML = enchantProbs.map(p => `
            <tr><td>${p.step}</td><td>${p.chance}%</td><td>${p.penalty}</td></tr>
        `).join('');
    }

    function updateUI() {
        document.getElementById('gold').innerText = state.gold.toLocaleString();
        let totalAtk = state.baseAtk + state.weapon.power + (state.weapon.enchant * (state.weapon.power * 0.2));
        document.getElementById('atk').innerText = Math.floor(totalAtk).toLocaleString();
        document.getElementById('w-name').innerText = state.weapon.name;
        document.getElementById('w-rank').className = ranks[state.weapon.rank].color;
        document.getElementById('w-enchant').innerText = "+" + state.weapon.enchant;
        
        let maxHp = 50 + (state.monsterLvl * 40);
        document.getElementById('hp-fill').style.width = (curHp / maxHp * 100) + "%";
        const mNames = ["ë“¤ì¥", "ê³ ë¸”ë¦°", "ìŠ¤ì¼ˆë ˆí†¤", "ì˜¤í¬", "ì™€ì´ë²ˆ", "ë¦¬ì¹˜", "ë°ìŠ¤ë‚˜ì´íŠ¸", "ë“œë˜ê³¤"];
        let mName = mNames[Math.min(Math.floor(state.monsterLvl/5), mNames.length-1)];
        document.getElementById('m-name').innerText = `${mName} (Lv.${state.monsterLvl})`;
        saveGame();
    }

    function log(msg) {
        const logDiv = document.getElementById('log');
        logDiv.innerHTML = `<div>> ${msg}</div>` + logDiv.innerHTML;
    }

    function attack() {
        let totalAtk = state.baseAtk + state.weapon.power + (state.weapon.enchant * (state.weapon.power * 0.2));
        curHp -= totalAtk;
        if (curHp <= 0) {
            let earn = 20 + (state.monsterLvl * 10);
            state.gold += earn;
            log(`ì²˜ì¹˜ ì™„ë£Œ! +${earn}G íšë“`);
            state.monsterLvl++;
            curHp = 50 + (state.monsterLvl * 40);
        }
        updateUI();
    }

    function enchant() {
        let cost = 100 + (state.weapon.enchant * 50);
        if (state.gold < cost) return log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        state.gold -= cost;

        // ì‹¤ì œ í™•ë¥  ë¡œì§ ì ìš©
        let currentStep = Math.min(state.weapon.enchant, 14);
        let chance = enchantProbs[currentStep].chance;
        
        if (Math.random() * 100 < chance) {
            state.weapon.enchant++;
            log(`ê°•í™” ì„±ê³µ! (+${state.weapon.enchant})`);
        } else {
            // ì‹¤íŒ¨ íŒ¨ë„í‹° ë¡œì§
            if (state.weapon.enchant >= 14) state.weapon.enchant -= 5;
            else if (state.weapon.enchant >= 11) state.weapon.enchant -= 3;
            else if (state.weapon.enchant >= 9) state.weapon.enchant -= 2;
            else if (state.weapon.enchant >= 3) state.weapon.enchant -= 1;
            
            state.weapon.enchant = Math.max(0, state.weapon.enchant);
            log("ê°•í™” ì‹¤íŒ¨! ìˆ˜ì¹˜ê°€ í•˜ë½í–ˆìŠµë‹ˆë‹¤.");
        }
        updateUI();
    }

    function gacha() {
        if (state.gold < 500) return log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        state.gold -= 500;
        const rand = Math.random() * 100;
        let newRank = "Common"; let newName = "ë‚¡ì€ ì² ê²€";
        if (rand < 1) { newRank = "Legendary"; newName = "ì‹ í™”ì˜ ì¢…ë§"; }
        else if (rand < 7) { newRank = "Epic"; newName = "í•™ì‚´ìì˜ ë„ë¼"; }
        else if (rand < 25) { newRank = "Rare"; newName = "ì •êµí•œ ë¡±ì†Œë“œ"; }
        state.weapon = { name: newName, rank: newRank, enchant: 0, power: ranks[newRank].power };
        log(`ë°œêµ´ ì„±ê³µ! [${newRank}] ${newName}`);
        updateUI();
    }

    function checkAdminCode() {
        const code = document.getElementById('adminCode').value;
        if (code === "27272727") {
            state.gold += 100000;
            log("ğŸ“¢ [ìš´ì˜ì] ì¹˜íŠ¸ ì ìš©: +100,000G");
            document.getElementById('adminCode').value = "";
            updateUI();
        } else { log("âŒ ì˜ëª»ëœ ì½”ë“œì…ë‹ˆë‹¤."); }
    }

    updateUI();
</script>
</body>
</html>
