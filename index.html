<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê·¼ë³¸ RPG - ì¸ë²¤í† ë¦¬ ì—ë””ì…˜</title>
    <style>
        body { background: #121212; color: #dcdcdc; font-family: 'Malgun Gothic', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        #game { width: 100%; max-width: 450px; background: #1c1c1c; padding: 25px; border-radius: 5px; border: 2px solid #3a3a3a; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        .header { text-align: center; border-bottom: 2px solid #3a3a3a; padding-bottom: 15px; margin-bottom: 20px; }
        .stats { display: flex; justify-content: space-between; font-size: 15px; background: #252525; padding: 12px; border: 1px solid #444; margin-bottom: 20px; }
        .weapon-box { text-align: center; padding: 25px; background: #000; border: 1px solid #444; margin-bottom: 20px; }
        .monster-area { background: #2d0000; padding: 15px; border: 1px solid #600; margin-bottom: 20px; text-align: center; }
        .hp-bar { height: 12px; background: #333; border: 1px solid #555; margin-top: 10px; overflow: hidden; }
        #hp-fill { height: 100%; background: #c0392b; width: 100%; transition: 0.1s; }
        
        /* ì¸ë²¤í† ë¦¬ ìŠ¤íƒ€ì¼ */
        .inventory { background: #151515; border: 1px solid #444; padding: 10px; margin-top: 20px; display: none; }
        .inv-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #333; font-size: 13px; }
        .inv-item:last-child { border-bottom: none; }
        .equip-btn { padding: 4px 8px; font-size: 11px; background: #444; color: #fff; border: 1px solid #666; cursor: pointer; }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { padding: 14px; border: 1px solid #555; background: #333; color: #eee; font-weight: bold; cursor: pointer; }
        button:hover { background: #444; }
        .atk-btn { background: #4b4b4b; grid-column: span 2; margin-bottom: 5px; }
        
        #log { height: 100px; background: #080808; border: 1px solid #333; padding: 10px; font-size: 12px; overflow-y: auto; margin-top: 15px; color: #999; }
        .rank-Common { color: #aaa; } .rank-Rare { color: #3498db; } .rank-Epic { color: #9b59b6; } .rank-Legendary { color: #f1c40f; }
    </style>
</head>
<body>

<div id="game">
    <div class="header"><h1>ê·¼ë³¸ RPG</h1></div>
    <div class="stats">
        <span>ê³¨ë“œ: <b id="gold" style="color: #f1c40f;">0</b>G</span>
        <span>ê³µê²©ë ¥: <b id="atk" style="color: #ff4757;">15</b></span>
    </div>

    <div class="weapon-box">
        <div id="w-rank">RANK</div>
        <div id="w-name" style="font-size:22px; font-weight:bold;">ì¥ë¹„ ì—†ìŒ</div>
        <div id="w-enchant" style="color: #4cd137; font-size: 18px;">+0</div>
    </div>

    <div class="monster-area">
        <div id="m-name">ëª¬ìŠ¤í„° (Lv.1)</div>
        <div class="hp-bar"><div id="hp-fill"></div></div>
    </div>

    <div class="btn-grid">
        <button class="atk-btn" onclick="attack()">ì‹¬ì—°ì˜ ìˆ˜ë ¨ (ê³µê²©)</button>
        <button onclick="enchant()">ê°•í™” (100G)</button>
        <button onclick="gacha()">ë°œêµ´ (500G)</button>
        <button onclick="toggleInv()" style="grid-column: span 2; background: #252525; margin-top: 5px;">ğŸ’ ì¸ë²¤í† ë¦¬ ì—´ê¸°/ë‹«ê¸°</button>
    </div>

    <div id="inventory" class="inventory">
        <div style="font-weight:bold; color:#f1c40f; margin-bottom:10px; border-bottom:1px solid #444;">ë‚´ ê°€ë°©</div>
        <div id="inv-list"></div>
    </div>

    <div id="log">> ëŒ€ë¥™ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.</div>
</div>

<script>
    // ìë™ ì €ì¥ ë° ì´ˆê¸° ë°ì´í„°
    let state = JSON.parse(localStorage.getItem('rpg_core_save')) || {
        gold: 0,
        baseAtk: 15,
        monsterLvl: 1,
        inventory: [{ id: Date.now(), name: "ìˆ˜ë ¨ìš© ëª©ê²€", rank: "Common", enchant: 0, power: 5 }],
        equippedId: null
    };
    
    if(!state.equippedId && state.inventory.length > 0) state.equippedId = state.inventory[0].id;

    const ranks = {
        Common: { power: 5 }, Rare: { power: 30 }, Epic: { power: 100 }, Legendary: { power: 400 }
    };

    let curHp = 50 + (state.monsterLvl * 40);

    function save() { localStorage.setItem('rpg_core_save', JSON.stringify(state)); }

    function updateUI() {
        const weapon = state.inventory.find(i => i.id === state.equippedId) || { name: "ë§¨ì†", rank: "Common", enchant: 0, power: 0 };
        document.getElementById('gold').innerText = state.gold.toLocaleString();
        let totalAtk = state.baseAtk + weapon.power + (weapon.enchant * (weapon.power * 0.2));
        document.getElementById('atk').innerText = Math.floor(totalAtk).toLocaleString();
        document.getElementById('w-name').innerText = weapon.name;
        document.getElementById('w-rank').innerText = weapon.rank.toUpperCase();
        document.getElementById('w-rank').className = "rank-" + weapon.rank;
        document.getElementById('w-enchant').innerText = "+" + weapon.enchant;
        
        let maxHp = 50 + (state.monsterLvl * 40);
        document.getElementById('hp-fill').style.width = (curHp / maxHp * 100) + "%";
        const mNames = ["ë“¤ì¥", "ê³ ë¸”ë¦°", "ìŠ¤ì¼ˆë ˆí†¤", "ì˜¤í¬", "ë“œë˜ê³¤"];
        document.getElementById('m-name').innerText = `${mNames[Math.min(Math.floor(state.monsterLvl/5), 4)]} (Lv.${state.monsterLvl})`;
        
        renderInventory();
        save();
    }

    function toggleInv() {
        const inv = document.getElementById('inventory');
        inv.style.display = inv.style.display === 'block' ? 'none' : 'block';
    }

    function renderInventory() {
        const list = document.getElementById('inv-list');
        list.innerHTML = state.inventory.map(item => `
            <div class="inv-item">
                <span class="rank-${item.rank}">${item.name} (+${item.enchant})</span>
                <button class="equip-btn" onclick="equip(${item.id})">${state.equippedId === item.id ? 'ì¥ì°©ì¤‘' : 'ì¥ì°©'}</button>
            </div>
        `).join('');
    }

    function equip(id) { state.equippedId = id; updateUI(); }

    function attack() {
        const weapon = state.inventory.find(i => i.id === state.equippedId) || { power: 0, enchant: 0 };
        let totalAtk = state.baseAtk + weapon.power + (weapon.enchant * (weapon.power * 0.2));
        curHp -= totalAtk;
        if (curHp <= 0) {
            state.gold += (20 + (state.monsterLvl * 10));
            state.monsterLvl++;
            curHp = 50 + (state.monsterLvl * 40);
        }
        updateUI();
    }

    function enchant() {
        let weapon = state.inventory.find(i => i.id === state.equippedId);
        if(!weapon) return log("ê°•í™”í•  ë¬´ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        let cost = 100 + (weapon.enchant * 50);
        if (state.gold < cost) return log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        state.gold -= cost;

        let chance = Math.max(5, 80 - (weapon.enchant * 5));
        if (Math.random() * 100 < chance) {
            weapon.enchant++;
            log(`ê°•í™” ì„±ê³µ! (+${weapon.enchant})`);
        } else {
            log("ê°•í™” ì‹¤íŒ¨! (ìˆ˜ì¹˜ëŠ” ìœ ì§€ë©ë‹ˆë‹¤)");
        }
        updateUI();
    }

    function gacha() {
        if (state.gold < 500) return log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        state.gold -= 500;
        const rand = Math.random() * 100;
        let rank = "Common"; let name = "ë‚¡ì€ ì² ê²€";
        if (rand < 2) { rank = "Legendary"; name = "ì‹ í™”ì˜ ì¢…ë§"; }
        else if (rand < 10) { rank = "Epic"; name = "í•™ì‚´ìì˜ ë„ë¼"; }
        else if (rand < 30) { rank = "Rare"; name = "ì •êµí•œ ë¡±ì†Œë“œ"; }
        
        const newItem = { id: Date.now(), name: name, rank: rank, enchant: 0, power: ranks[rank].power };
        state.inventory.push(newItem);
        log(`ë°œêµ´ ì„±ê³µ! [${rank}] ${name} íšë“!`);
        updateUI();
    }

    function log(msg) {
        const logDiv = document.getElementById('log');
        logDiv.innerHTML = `<div>> ${msg}</div>` + logDiv.innerHTML;
    }

    updateUI();
</script>
</body>
</html>
